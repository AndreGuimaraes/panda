Panda on EC2
============

Launch the AMI
--------------
ec2-run-instances ami-5538dd3c -k pv-keypair

(FIX) Install stuff which will be in the next AMI
-------------------------------------------

See README

Nginx
-----

Required for progress uploads. Config is in /usr/local/nginx/conf/nginx.conf
Bin is /usr/local/nginx/sbin/nginx

Grab Panda
----------

cd /usr/local/www
git clone git://github.com/newbamboo/panda.git
mkdir /usr/local/panda/www/videos # Place for temp videos
mkdir /usr/local/panda/www/log

Configure Panda
---------------

Edit `config/panda_init.rb` and enter your AWS keys and other details.

Create buckets, domains and queues
----------------------------------

* S3 bucket for video files (tip: name this a domain such videos.pandastream.com and you can setup a CNAME to S3)
* SQS queue for the encoding queue
* SimpleDB domains for videos, profiles and admin users

Login to the console with `merb -i` and run the following, probably replacing names with your own:

    Panda::Setup.create_s3_bucket('videos.pandastream.com')
    Panda::Setup.create_sqs_queue('panda_encoding')
    Panda::Setup.create_sdb_domain('panda_videos')
    Panda::Setup.create_sdb_domain('panda_profiles')
    Panda::Setup.create_sdb_domain('panda_users')

    S3VideoObject.store("flvplayer.swf", File.open("flvplayer.swf"), :access => :public_read)
    
Create first admin user
-----------------------

Login to the console with `merb -i`:

    u = User.new
    u.login = 'admin'
    u.email = 'email@mydomain'
    u.set_password('SECRETPASS')
    u.save

Create an encoding profile
--------------------------

    Profile.create!(:title => "Flash video HI",  :container => "flv", :video_bitrate => 400, :audio_bitrate => 48, :width => 480, :height => 360, :fps => 24, :position => 1, :player => "flash")
    
Configure Nginx
---------------

Edit your Nginx config as needed. The default config symlinks to `/usr/local/nginx/conf/nginx-panda.conf` and is setup to talk to Merb on port 4001.

Start Panda
-----------

Start God and load the Panda config.

    god
    god load /usr/local/www/panda/panda.god

    cd /usr/local/www/panda
    merb